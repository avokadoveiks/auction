<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–ú–µ–Ω—é ‚Äî –ê—É–∫—Ü–∏–æ–Ω–Ω–∞—è –∏–≥—Ä–∞</title>
  <link rel="manifest" href="/js/manifest.json" />
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="–ê—É–∫—Ü–∏–æ–Ω" />
  <!-- Preload menu background -->
  <link rel="preload" as="image" href="assets/images/menu-bg.png" />
  <link rel="stylesheet" href="css/menu.css?v=1761788419">
  <link rel="stylesheet" href="css/v1.css?v=2025-10-25-8">
  <link rel="stylesheet" href="css/bank.css?v=2025-10-20-1">
  <link rel="stylesheet" href="css/realestate.css?v=2025-10-27-v1">
  <link rel="stylesheet" href="css/events.css?v=2025-10-27-v1">
  <script src="js/localization-manager.js?v=1761679997"></script>
  <style>
    .neon-edges { position: absolute; inset: 0; pointer-events: none; z-index: 0; contain: paint; }
    .neon-edges::before { content: ""; position: absolute; inset: 0; border-radius: 16px; clip-path: inset(0);
      background:
        linear-gradient(90deg, rgba(0,255,255,0.28), rgba(0,255,255,0) 45%) top/100% 6px no-repeat,
        linear-gradient(270deg, rgba(255,0,153,0.28), rgba(255,0,153,0) 45%) bottom/100% 6px no-repeat,
        linear-gradient(0deg, rgba(255,255,0,0.24), rgba(255,255,0,0) 45%) left/6px 100% no-repeat,
        linear-gradient(180deg, rgba(0,255,255,0.24), rgba(0,255,255,0) 45%) right/6px 100% no-repeat;
      filter: blur(3px) saturate(1.08);
      animation: neon-breathe 6s ease-in-out infinite;
    }
    @keyframes neon-breathe { 0%,100% { opacity: .45 } 50% { opacity: .9 } }
    
    /* Landscape: safe-area –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è */
    @media screen and (orientation: landscape) {
      html, body {
        height: var(--app-height, 100dvh) !important;
        max-height: var(--app-height, 100dvh) !important;
      }
      
      #gameCanvas {
        height: var(--app-height, 100dvh) !important;
        max-height: var(--app-height, 100dvh) !important;
      }
      
      #menu-rotate {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: var(--app-width, 100vw) !important;
        height: var(--app-height, 100dvh) !important;
        max-height: var(--app-height, 100dvh) !important;
        overflow: hidden !important;
        box-sizing: border-box !important;
      }
    }
    
    /* –ü–æ—Ä—Ç—Ä–µ—Ç: –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç (–º–µ–Ω—é –≤—Å–µ–≥–¥–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ) */
    @media screen and (orientation: portrait) {
      .leagues-popup__list,
      .language-list,
      .events-popup__card,
      .friends-list,
      .friends-list__items,
      .bank-body,
      .realestate-body {
        -webkit-overflow-scrolling: touch !important;
      }

      html {
        height: var(--app-height, 100dvh) !important;
        min-height: var(--app-height, 100dvh) !important;
        width: var(--app-width, 100vw) !important;
        position: fixed !important;
        overflow: hidden !important;
      }
      
      body { 
        height: var(--app-height, 100dvh) !important;
        min-height: var(--app-height, 100dvh) !important;
        width: var(--app-width, 100vw) !important;
        overflow: hidden !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      #menu-rotate {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: var(--app-height, 100dvh) !important;
        height: var(--app-width, 100vw) !important;
        transform-origin: top left !important;
        transform: rotate(90deg) translateY(-100%) !important;
        -webkit-transform: rotate(90deg) translateY(-100%) !important;
        backface-visibility: hidden;
        will-change: transform;
        overflow: hidden !important;
        -webkit-overflow-scrolling: auto !important;
        /* Safe-area –æ—Ç—Å—Ç—É–ø—ã: –ø–æ—Å–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ left/right = top/bottom; –¥–æ–±–∞–≤–ª–µ–Ω –≤–∏–¥–∏–º—ã–π fallback */
        padding-top: max(clamp(16px, 6vw, 48px), var(--rot-safe-top, var(--safe-left))) !important;
        padding-bottom: max(clamp(16px, 6vw, 48px), var(--rot-safe-bottom, var(--safe-right))) !important;
        padding-left: var(--rot-safe-left, var(--safe-top)) !important;
        padding-right: var(--rot-safe-right, var(--safe-bottom)) !important;
        box-sizing: border-box !important;
      }
    }
  </style>
  <script>
    (function () {
      var root = document.documentElement;
      var mediaPortrait = window.matchMedia('(orientation: portrait)');
      function toPx(value) {
        return (value || 0).toFixed(2) + 'px';
      }
      function updateSafeArea() {
        var vv = window.visualViewport;
        if (!vv) {
          return;
        }
        var scale = vv.scale || 1;
        var left = vv.offsetLeft / scale;
        var top = vv.offsetTop / scale;
        var right = Math.max(0, (window.innerWidth - vv.width - vv.offsetLeft) / scale);
        var bottom = Math.max(0, (window.innerHeight - vv.height - vv.offsetTop) / scale);

        root.style.setProperty('--safe-left', toPx(left));
        root.style.setProperty('--safe-right', toPx(right));
        root.style.setProperty('--safe-top', toPx(top));
        root.style.setProperty('--safe-bottom', toPx(bottom));

        var isPortrait = mediaPortrait.matches;
        if (isPortrait) {
          root.style.setProperty('--rot-safe-top', toPx(left));
          root.style.setProperty('--rot-safe-bottom', toPx(right));
          root.style.setProperty('--rot-safe-left', toPx(top));
          root.style.setProperty('--rot-safe-right', toPx(bottom));
        } else {
          root.style.setProperty('--rot-safe-top', toPx(top));
          root.style.setProperty('--rot-safe-bottom', toPx(bottom));
          root.style.setProperty('--rot-safe-left', toPx(left));
          root.style.setProperty('--rot-safe-right', toPx(right));
        }
      }

      var vv = window.visualViewport;
      if (vv) {
        vv.addEventListener('resize', updateSafeArea);
        vv.addEventListener('scroll', updateSafeArea);
      }
      var portraitListener = function () {
        setTimeout(updateSafeArea, 200);
      };
      if (mediaPortrait.addEventListener) {
        mediaPortrait.addEventListener('change', portraitListener);
      } else if (mediaPortrait.addListener) {
        mediaPortrait.addListener(portraitListener);
      }
      window.addEventListener('orientationchange', function () {
        setTimeout(updateSafeArea, 200);
      });
      window.addEventListener('resize', updateSafeArea);
      window.addEventListener('load', updateSafeArea);
      updateSafeArea();
    })();
  </script>
  <script>
    // Visible banner to confirm fresh HTML is loaded
    (function(){
      const b = document.createElement('div');
      b.textContent = 'Index HTML v4 (clean) loaded';
      Object.assign(b.style, { position:'fixed', top:'40px', left:'50%', transform:'translateX(-50%)', background:'#111827', color:'#93c5fd', padding:'6px 10px', borderRadius:'8px', zIndex:9999, font:'12px/1.2 ui-sans-serif', boxShadow:'0 4px 12px rgba(0,0,0,.35)'});
      document.addEventListener('DOMContentLoaded', ()=>{ document.body.appendChild(b); setTimeout(()=>b.remove(), 1800); });
    })();

    // Native app behavior: prevent default browser gestures
    (function(){
  const SCROLLABLE_SELECTOR = '.leagues-popup__list, .language-list, .events-popup__card, .friends-list, .friends-list__items, .bank-body, .realestate-body';

      const isWithinScrollable = (node) => {
        let current = node;
        while (current && current !== document.body && current !== document.documentElement) {
          if (current.matches && current.matches(SCROLLABLE_SELECTOR)) {
            if (current.scrollHeight > current.clientHeight || current.scrollWidth > current.clientWidth) {
              return true;
            }
          }
          current = current.parentElement;
        }
        return false;
      };

      const preventScroll = (event) => {
        if (isWithinScrollable(event.target)) {
          return;
        }
        event.preventDefault();
        event.stopPropagation();
        return false;
      };

      const resetScrollPosition = () => {
        window.scrollTo(0, 0);
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
      };

      document.addEventListener('DOMContentLoaded', () => {
        ['html', 'body'].forEach(selector => {
          const el = document.querySelector(selector);
          if (el) {
            el.style.overflow = 'hidden';
            el.style.position = 'fixed';
            el.style.width = '100%';
            el.style.touchAction = 'none';
            el.style.overscrollBehavior = 'none';
          }
        });
        resetScrollPosition();
      });

      ['touchmove', 'wheel'].forEach(evt => {
        window.addEventListener(evt, preventScroll, { passive: false });
        document.addEventListener(evt, preventScroll, { passive: false });
      });

      window.addEventListener('scroll', resetScrollPosition, { passive: false });
      document.addEventListener('scroll', resetScrollPosition, { passive: false });

      // Prevent context menu (long press menu on mobile)
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      }, { passive: false });

      // Prevent double-tap zoom on iOS
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, { passive: false });

      // Prevent pinch zoom
      document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
      }, { passive: false });

      document.addEventListener('gesturechange', function(e) {
        e.preventDefault();
      }, { passive: false });

      document.addEventListener('gestureend', function(e) {
        e.preventDefault();
      }, { passive: false });
    })();

    // Fix iOS viewport height to eliminate bottom black bar
    function fixViewportHeight() {
      var vv = window.visualViewport;
      var rawH = vv ? vv.height : window.innerHeight;
      var rawW = vv ? vv.width : window.innerWidth;
      // Ceil to avoid 1px underflow causing a bottom stripe on iOS
      var height = Math.ceil(rawH);
      var width = Math.ceil(rawW);
      var heightPx = height + 'px';
      var widthPx = width + 'px';

      document.documentElement.style.setProperty('--app-height', heightPx);
      document.documentElement.style.setProperty('--app-width', widthPx);
      
      // –ñ—ë—Å—Ç–∫–æ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã –ë–ï–ó –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
      var root = document.documentElement;
      root.style.height = heightPx;
      root.style.minHeight = heightPx;
      root.style.maxHeight = heightPx;
      root.style.width = widthPx;
      root.style.minWidth = widthPx;
      root.style.overflow = 'hidden';
      
      var body = document.body;
      body.style.height = heightPx;
      body.style.minHeight = heightPx;
      body.style.maxHeight = heightPx;
      body.style.width = widthPx;
      body.style.minWidth = widthPx;
      body.style.overflow = 'hidden';

      var canvas = document.getElementById('gameCanvas');
      if (canvas) {
        canvas.style.height = heightPx;
        canvas.style.minHeight = heightPx;
        canvas.style.maxHeight = heightPx;
        canvas.style.width = widthPx;
        canvas.style.minWidth = widthPx;
      }
      
      var menuRotate = document.getElementById('menu-rotate');
      if (menuRotate) {
        menuRotate.style.height = heightPx;
        menuRotate.style.maxHeight = heightPx;
      }
    }
    // –í—ã–∑—ã–≤–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    fixViewportHeight();
    if (window.visualViewport) {
      window.visualViewport.addEventListener('resize', fixViewportHeight);
      window.visualViewport.addEventListener('scroll', fixViewportHeight);
    }
    window.addEventListener('resize', fixViewportHeight);
    window.addEventListener('orientationchange', fixViewportHeight);
    window.addEventListener('load', fixViewportHeight);
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ RAF –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
    requestAnimationFrame(fixViewportHeight);
    // –ò –µ—â—ë –æ–¥–∏–Ω —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞ —Å–ª—É—á–∞–π –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞
    setTimeout(fixViewportHeight, 100);
  </script>
  <!-- Match page background to avoid 1px seam on iOS bottom safe area -->
  <meta name="theme-color" content="#0a0f1e" />
</head>
<body>
  <div id="gameCanvas">
    <div id="menu-rotate">
      <div id="bg"></div>
      <canvas id="sparks-canvas" aria-hidden="true"></canvas>
  <div class="bg-overlay" aria-hidden="true"></div>
  <div class="bg-hammer" aria-hidden="true"></div>
  <div class="neon-edges" aria-hidden="true"></div>

  <div id="ui-root">
  <main class="menu-screen" role="main">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: –∏–º—è, –±–∞–ª–∞–Ω—Å, —Ä–µ—Å—É—Ä—Å—ã, –ø–æ—á—Ç–∞ -->
    <header class="menu-header" aria-label="–í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å">
      <div class="topbar">
        <div class="topbar__left">
          <div class="avatar-small" id="menuAvatar" title="–í–∞—à –∞–≤–∞—Ç–∞—Ä"></div>
          <div class="user-block">
            <div class="user-name" id="menuName">–ì–æ—Å—Ç—å</div>
            <div class="user-balance" id="menuBalance">–ë–∞–ª–∞–Ω—Å: 9 800 –º–æ–Ω–µ—Ç</div>
          </div>
        </div>
        <div class="topbar__right">
          <button class="top-icon" id="mailBtn" type="button" title="–ü–æ—á—Ç–∞">‚úâÔ∏è</button>
          <button class="top-icon" id="reloadBtn" type="button" title="–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É">üîÑ</button>
          <button class="top-icon" id="settingsBtn" type="button" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
          <div class="version-badge" title="–í–µ—Ä—Å–∏—è –º–µ–Ω—é">v1.6.6</div>
        </div>
      </div>
    </header>

    <!-- –°—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å: —Å–ª–µ–≤–∞ –∞–≤–∞—Ç–∞—Ä + –ë–∞–Ω–∫/–ú–∞–≥–∞–∑–∏–Ω/–°–æ–±—ã—Ç–∏—è, —Ü–µ–Ω—Ç—Ä –ø—É—Å—Ç–æ–π, —Å–ø—Ä–∞–≤–∞ –¥—Ä—É–∑—å—è -->
    <div class="menu-content">
      <aside class="left-panel" aria-label="–õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å">
        <div class="left-panel__actions">
          <button class="btn btn--panel" id="bankBtn" type="button">
            <span class="btn-icon">üè¶</span>
            <span class="btn-label" data-localize="menu_bank">–ë–∞–Ω–∫</span>
          </button>
          <button class="btn btn--panel" id="realestateBtn" type="button">
            <span class="btn-icon">üè†</span>
            <span class="btn-label" data-localize="menu_realestate">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</span>
          </button>
          <button class="btn btn--panel" id="storeBtn" type="button">
            <span class="btn-icon">üõí</span>
            <span class="btn-label" data-localize="menu_store">–ú–∞–≥–∞–∑–∏–Ω</span>
          </button>
          <button class="btn btn--panel" id="eventsBtn" type="button">
            <span class="btn-icon">üéâ</span>
            <span class="btn-label" data-localize="menu_events">–°–æ–±—ã—Ç–∏—è</span>
          </button>
        </div>
      </aside>

      <section class="menu-center" aria-label="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞"></section>

      <aside class="friends-panel" aria-label="–î—Ä—É–∑—å—è">
        <button class="btn friends-toggle" id="friendsToggle" type="button" aria-expanded="false">
          <span class="friends-toggle__icon">‚û§</span>
          <span class="friends-toggle__label" data-localize="menu_friends">–î—Ä—É–∑—å—è</span>
        </button>
        <div class="friends-list" id="friendsList" hidden>
          <div class="friends-list__scrollable">
            <ul class="friends-list__items" id="friendsItems"></ul>
          </div>
          <button class="btn btn--panel friends-invite friends-add-btn" id="addFriendBtn" type="button">
            <span class="add-friend-icon">üë§‚ûï</span>
            <span>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</span>
          </button>
        </div>
      </aside>
    </div>
  </main>

  <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å: –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å–ª–µ–≤–∞, CTA —Å–ø—Ä–∞–≤–∞ -->
  <footer class="menu-bottom" aria-label="–ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å">
    <nav class="menu-bottom__nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="btn nav-button" id="bagBtn" type="button">
        <span class="nav-button__icon">üéí</span>
        <span class="nav-button__label" data-localize="menu_bag">–°—É–º–∫–∞</span>
      </button>
      <button class="btn nav-button" id="achievementsBtn" type="button">
        <span class="nav-button__icon">üèÜ</span>
        <span class="nav-button__label" data-localize="menu_top">–¢–æ–ø</span>
      </button>
      <button class="btn nav-button" id="bugReportBtn" type="button">
        <span class="nav-button__icon">üêõ</span>
        <span class="nav-button__label" data-localize="menu_bug_report">–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ</span>
      </button>
      <button class="btn nav-button" id="feedbackBtn" type="button">
        <span class="nav-button__icon">üí°</span>
        <span class="nav-button__label" data-localize="menu_feedback">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å</span>
      </button>
      <button class="btn nav-button" id="modeBtn" type="button">
        <span class="nav-button__icon">‚öîÔ∏è</span>
        <span class="nav-button__label" data-localize="menu_mode">–†–µ–∂–∏–º</span>
      </button>
    </nav>
    <div class="menu-actions" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
      <button class="btn cta cta--secondary" id="leaguesBtn" type="button" data-localize="menu_leagues">–õ–∏–≥–∞</button>
      <button class="btn cta cta--primary" id="playBtn" type="button" data-localize="menu_play">–ò–≥—Ä–∞—Ç—å</button>
    </div>
  </footer>
  </div><!-- /#ui-root -->
</div>

  <!-- Popup: –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å -->
  <div class="leagues-popup" id="feedbackPopup" hidden>
    <div class="leagues-popup__backdrop" id="feedbackBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card" role="dialog" aria-modal="true" aria-labelledby="feedbackPopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="feedbackPopupTitle" data-localize="feedback_title">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–¥–µ—é</h2>
        <button class="leagues-popup__close" id="feedbackCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="feedback-body">
        <p class="feedback-description" data-localize="feedback_description">–ü–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–µ–π –∏–¥–µ–µ–π –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–≥—Ä—ã!</p>
        <textarea 
          class="feedback-textarea" 
          id="feedbackTextarea" 
          placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–¥–µ—Å—å..."
          data-localize-placeholder="feedback_placeholder"
          rows="6"
          maxlength="500"></textarea>
        <div class="feedback-counter">
          <span id="feedbackCharCount">0</span> / 500
        </div>
        <div class="feedback-actions">
          <button class="btn feedback-btn feedback-btn--back" id="feedbackBackBtn" data-localize="feedback_back">–ù–∞–∑–∞–¥</button>
          <button class="btn feedback-btn feedback-btn--submit" id="feedbackSubmitBtn" data-localize="feedback_submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
      <div class="feedback-success" id="feedbackSuccess" hidden>
        <span class="feedback-success-icon">‚úì</span>
        <p class="feedback-success-text" data-localize="feedback_success">–°–ø–∞—Å–∏–±–æ! –¢–≤–æ—è –∏–¥–µ—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</p>
      </div>
    </div>
  </div>

  <!-- Popup: –°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ -->
  <div class="leagues-popup" id="bugReportPopup" hidden>
    <div class="leagues-popup__backdrop" id="bugReportBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card" role="dialog" aria-modal="true" aria-labelledby="bugReportPopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="bugReportPopupTitle" data-localize="bug_report_title">–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ</h2>
        <button class="leagues-popup__close" id="bugReportCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="feedback-body">
        <p class="feedback-description" data-localize="bug_report_description">–û–ø–∏—à–∏—Ç–µ –±–∞–≥ –∏–ª–∏ –æ—à–∏–±–∫—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –≤ –∏–≥—Ä–µ.</p>
        <textarea 
          class="feedback-textarea" 
          id="bugReportTextarea" 
          placeholder="–û–ø–∏—à–∏—Ç–µ –æ—à–∏–±–∫—É –∑–¥–µ—Å—å..."
          data-localize-placeholder="bug_report_placeholder"
          rows="6"
          maxlength="500"></textarea>
        <div class="feedback-counter">
          <span id="bugReportCharCount">0</span> / 500
        </div>
        <div class="feedback-actions">
          <button class="btn feedback-btn feedback-btn--back" id="bugReportBackBtn" data-localize="feedback_back">–ù–∞–∑–∞–¥</button>
          <button class="btn feedback-btn feedback-btn--submit" id="bugReportSubmitBtn" data-localize="feedback_submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
      <div class="feedback-success" id="bugReportSuccess" hidden>
        <span class="feedback-success-icon">‚úì</span>
        <p class="feedback-success-text" data-localize="bug_report_success">–°–ø–∞—Å–∏–±–æ! –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</p>
      </div>
    </div>
  </div>

  <!-- Popup: –í–∞—à–∞ –ª–∏–≥–∞ -->
  <div class="leagues-popup" id="leaguesPopup" hidden>
    <div class="leagues-popup__backdrop" id="leaguesBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card" role="dialog" aria-modal="true" aria-labelledby="leaguesPopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="leaguesPopupTitle">–í–∞—à–∞ –ª–∏–≥–∞</h2>
        <button class="leagues-popup__close" id="leaguesCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="leagues-popup__list" id="leagueChoices"></div>
    </div>
  </div>

  <!-- Popup: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div class="leagues-popup" id="settingsPopup" hidden>
    <div class="leagues-popup__backdrop" id="settingsBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card" role="dialog" aria-modal="true" aria-labelledby="settingsPopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="settingsPopupTitle" data-localize="menu_settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <button class="leagues-popup__close" id="settingsCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="leagues-popup__list" style="padding: 8px 4px; display: flex; flex-direction: column; gap: 10px;">
        <!-- Language Selection -->
        <button class="btn btn--panel" id="languageOpenBtn" type="button" style="display: flex; justify-content: space-between; align-items: center;">
          <span data-localize="settings_language">–Ø–∑—ã–∫ / Language</span>
          <span style="font-size: 18px;">‚Üí</span>
        </button>
        
        <button class="btn btn--panel" id="signOutBtn" type="button" data-localize="settings_signout">–°–º–µ–Ω–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
      </div>
    </div>
  </div>

  <!-- Popup: –í—ã–±–æ—Ä —è–∑—ã–∫–∞ -->
  <div class="leagues-popup" id="languagePopup" hidden>
    <div class="leagues-popup__backdrop" id="languageBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card" role="dialog" aria-modal="true" aria-labelledby="languagePopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="languagePopupTitle" data-localize="settings_language">–Ø–∑—ã–∫ / Language</h2>
        <button class="leagues-popup__close" id="languageCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="leagues-popup__list" id="languageList"></div>
    </div>
  </div>

  <!-- Popup: –¢–æ–ø (–ò—Å—Ç–æ—Ä–∏—è –ø–æ–±–µ–¥) -->
  <div class="leagues-popup" id="winnersPopup" hidden>
    <div class="leagues-popup__backdrop" id="winnersBackdrop" aria-hidden="true"></div>
    <div class="leagues-popup__card winners-popup-card" role="dialog" aria-modal="true" aria-labelledby="winnersPopupTitle">
      <header class="leagues-popup__header">
        <h2 class="leagues-popup__title" id="winnersPopupTitle">–¢–æ–ø</h2>
        <button class="leagues-popup__close" id="winnersCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div class="winners-tabs">
        <button class="tab-button active" data-period="recent">–ù–µ–¥–∞–≤–Ω–∏–µ</button>
        <button class="tab-button" data-period="24h">24—á</button>
        <button class="tab-button" data-period="7d">7–¥–Ω</button>
        <button class="tab-button" data-period="1m">1–º–µ—Å</button>
      </div>
      <div class="winners-list-container" id="winnersListMenu"></div>
    </div>
  </div>

  <!-- Popup: –°–æ–±—ã—Ç–∏—è -->
  <div class="events-popup" id="eventsPopup" hidden>
    <div class="events-popup__backdrop" id="eventsBackdrop" aria-hidden="true"></div>
    <div class="events-popup__card" role="dialog" aria-modal="true" aria-labelledby="eventsPopupTitle">
      <header class="events-popup__header">
        <h2 class="events-popup__title" id="eventsPopupTitle" data-localize="events_title">–°–æ–±—ã—Ç–∏—è</h2>
        <button class="events-popup__close" id="eventsCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </header>
      <div id="eventsContent"></div>
    </div>
  </div>

  </div>
  <script src="js/sparks-effect.js?v=1761679997"></script>
  <script src="js/bank-system.js?v=2025-10-20-1"></script>
  <script src="js/bank-ui.js?v=2025-10-20-1"></script>
  <script src="js/realestate-system.js?v=2025-10-27-v1"></script>
  <script src="js/realestate-ui.js?v=2025-10-27-v1"></script>
  <script src="js/events-system.js?v=2025-10-27-v1"></script>
  <script src="js/events-ui.js?v=2025-10-27-v1"></script>
  <script src="js/menu.js?v=1761788419"></script>
  <!-- Firebase for sign-out in settings -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js" defer></script>
  <script src="js/firebase-config.js" defer></script>
  <script type="module">
    import { initLeaguesPanel } from './src/ui/leaguesPanel.js';

    window.addEventListener('DOMContentLoaded', () => {
      initLeaguesPanel().catch(error => {
        console.error('[Menu] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–Ω–µ–ª–µ–π –ª–∏–≥', error);
      });
    });
  </script>
  <script>
    // –û—Ç–∫–ª—é—á–∞–µ–º —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(reg => reg.unregister());
      });
    }
    /* –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–Å–ù
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function(){
        navigator.serviceWorker.register('js/sw-v2.js')
          .then(reg => {
            console.log('[SW] Registered');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(() => {
              reg.update();
            }, 1 * 60 * 1000);
            
            // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            reg.addEventListener('updatefound', () => {
              const newWorker = reg.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  showUpdateNotification();
                }
              });
            });
          })
          .catch(err => console.log('[SW] Registration failed:', err));
        
        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
        navigator.serviceWorker.addEventListener('message', event => {
          if (event.data && event.data.type === 'SW_UPDATED') {
            console.log('[SW] New version activated:', event.data.version);
            showUpdateNotification();
          }
        });
      });
      
      // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
      function showUpdateNotification() {
        const notification = document.createElement('div');
        notification.innerHTML = `
          <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 10000; background: linear-gradient(135deg, #3f82ff, #79a8ff); color: #fff; padding: 16px 24px; border-radius: 12px; box-shadow: 0 8px 24px rgba(63, 130, 255, 0.4); display: flex; align-items: center; gap: 12px; font-family: system-ui; max-width: 90vw;">
            <span>üéâ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!</span>
            <button onclick="location.reload()" style="background: rgba(255,255,255,0.95); color: #3f82ff; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: inherit;">
              –û–±–Ω–æ–≤–∏—Ç—å
            </button>
            <button onclick="this.closest('div').parentElement.remove()" style="background: transparent; color: rgba(255,255,255,0.8); border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-family: inherit;">
              –ü–æ–∑–∂–µ
            </button>
          </div>
        `;
        document.body.appendChild(notification);
        
        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          if (notification.parentElement) notification.remove();
        }, 10000);
      }
    }
    */
  </script>
  
  <!-- Dev Helper: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 1000 —Å–¥–µ–ª–æ–∫
    window.setDevDeals = function(accountId = 'delta', deals = 1000) {
      if (typeof RealEstateSystem === 'undefined') {
        console.error('RealEstateSystem –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        return;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ
      const key = `realestate_${accountId}`;
      let state = JSON.parse(localStorage.getItem(key) || 'null');
      
      if (!state) {
        state = {
          successfulDeals: deals,
          owned: {},
          lastCollection: {}
        };
      } else {
        state.successfulDeals = deals;
      }
      
      localStorage.setItem(key, JSON.stringify(state));
      console.log(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${deals} —É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ ID: "${accountId}"`);
      console.log('–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', state);
      console.log('–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏');
    };
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ "delta" (–û–ª–µ–≥) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      setTimeout(() => {
        const key = `realestate_delta`;
        let state = JSON.parse(localStorage.getItem(key) || 'null');
        if (!state || (state.successfulDeals || 0) < 1000) {
          window.setDevDeals('delta', 1000);
          console.log('üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 1000 —Å–¥–µ–ª–æ–∫ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞ –û–ª–µ–≥ (ID: delta)');
        }
      }, 500);
    });
  </script>
  <!-- Simple iOS canvas sizing fix: force the main canvas to exactly window inner size -->
  <script>
    function fixCanvasSize() {
      const canvas = document.getElementById('gameCanvas');
      if (!canvas) return;
      canvas.style.position = 'fixed';
      canvas.style.top = '0';
      canvas.style.left = '0';
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
    }
    // –í—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å load
    fixCanvasSize();
    // –ò –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
    window.addEventListener('load', fixCanvasSize);
    window.addEventListener('resize', fixCanvasSize);
    window.addEventListener('orientationchange', fixCanvasSize);
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ requestAnimationFrame –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
    requestAnimationFrame(fixCanvasSize);
  </script>
</body>
</html>
